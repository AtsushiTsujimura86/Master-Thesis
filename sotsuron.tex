% !TEX encoding = UTF-8 Unicode
\documentclass[12pt]{jreport}
\usepackage{suthesis}
\usepackage[dvipdfm]{graphicx}
\usepackage{listings, jvlisting}
\usepackage{float}
\graphicspath{{figs/}}
\DeclareGraphicsExtensions{.pdf,.jpg,png,PNG}
\renewcommand{\lstlistingname}{ソースコード}
\lstset{
    frame=shadowbox,
    numbers=left,
    tabsize=2,
    breaklines=true,
    columns=fixed,
    basewidth=0.5em,
    framesep=0.2cm
}

% 表紙
\thesis{
\bf 2025年度 \\ 
%
% select one of the following
修士論文
}

\title{
\bf SN開発におけるデバッグシステムの開発 \\
}

\professor{
\begin{tabular}[t]{lr}
アサノ デービッド & 教授 \\
不破 泰 & 肩書き \\
\end{tabular}
}

\date{
2025年1月30日提出
}

\author{
信州大学大学院 総合理工学研究科 工学専攻 情報数理・融合システム分野 \\ 
24W6047A\\
辻村篤志 \\
}

% 本文
\begin{document}
\maketitle
\maegaki

\begin{jabstract} %あらまし
あらましを書く。

\end{jabstract}

\maetsuke
\tableofcontents
\listoffigures
\listoftables

\hombun

%_/_/_/_/_/_第一章_/_/_/_/_/_
\chapter{はじめに} 
はじめにを書く。
\section{研究背景}
\begin{par}
近年、無線センサネットワーク（Wireless Sensor Network：WSN）やIoT（Internet of Things）は、環境モニタリングやスマートシティ、インフラ監視、農業、ヘルスケアなど、さまざまな分野での応用が期待されている。実際，IoT全体の接続デバイス数は急速に増加している。IoT Analyticsによれば，2023年時点で約166億台，2024年には約188億台に達し，2030年には約400億台に到達すると予測されている\cite{iotanalytics2024}。また，WSNの普及も市場規模の面から拡大を続けており，Grand View Researchの報告では，産業用WSN（Industrial WSN）の市場は2023年に約51.9億ドルと推定され，2024年から2030年にかけて年平均12.1\%の成長が見込まれている\cite{grandview2024}。


しかし、これらのシステムを構築するためには、複雑な通信プロトコルの設計やデータ処理の設計および実装が求められ、開発者には幅広い専門知識と多大な工数が必要となる。さらに、無線通信環境の構築やマイコン設定など導入時のハードルも高く、これらの研究や開発の多くはシミュレーション環境やエミュレータ上での検証にとどまることが多い。しかし、シミュレーション環境では実機特有の挙動や外部環境の影響を完全に再現することが難しく、実機での検証が不可欠である場合も多く、実機でのプロトコル検証を容易にするための支援環境の整備が求められている。
\end{par}

\section{当研究室における先行研究}
\begin{par}
当研究室の先行研究では、状態遷移図上で無線通信プロトコルの動作を定義し、そこから自動生成したプログラムを汎用ハード上で動作させ、プロトコルを実機で動作検証できる環境が構築されていた（旭ら\cite{asahi}、小林ら\cite{kobayashi}）。
\end{par}
\section{先行研究の課題}
\begin{par}
このシステムにより基本的な通信プロトコルの動作検証が可能となったが、デバッグ方法はコンソールへのログ出力に依存しており、通信処理が高速に進むため逐次的な状態遷移を追跡することが難しかった。その結果、複雑な動作を含むプロトコルに対しては、異常動作の原因を把握しづらく、開発効率や教育的利用の観点では十分でない点が課題として残されていた。
\end{par}

\section{本研究の目的}
\begin{par}
本研究の目的は、先行研究で課題となっていたデバッグ効率の低さを改善し、実機でのプロトコル検証をより効果的に行える環境を実現することである。そのために、無線通信デバイス上で実行された動作をログとして出力し、それを可視化・ステップ実行できる仕組みを開発した。これにより、プロトコルの動作を逐次的に把握でき、異常動作の原因究明を容易にするとともに、教育やチーム開発、応用実証に適した支援環境を提供することを目指す。
\end{par}

\section{本論文の構成}
\begin{par}
本論文は全7章から構成されている。第1章では、本研究の背景として当研究室におけるこれまでの研究の流れを整理し、先行研究で顕在化した課題を明らかにした上で、本研究の目的を述べる。  
第2章では、当研究室における先行研究システムについて、その構成や実現されてきた機能を整理するとともに、運用およびデバッグの観点から課題をまとめる。  
第3章では、先行研究の課題を踏まえ、本研究で提案するシステムの概要と設計方針について述べる。ここでは、全体構成および各コンポーネントの役割を中心に説明する。  
第4章では、提案システムの設計および実装について述べ、特にデバッグ支援を目的としたログ取得方式や状態遷移の可視化手法について詳述する。  
第5章では、提案システムの操作例を示し、実際の利用を通してどのような情報が得られるかを説明する。  
第6章では、従来手法との比較を通じて提案システムの有効性を評価し、その結果について考察を行う。  
最後に第7章では、本研究のまとめを行うとともに、今後の課題および展望について述べる。
\end{par}


%_/_/_/_/_/_第二章_/_/_/_/_/_
\chapter{先行研究の提案システム}
\section{システムの概要}
\begin{par}
先行研究では、無線通信プロトコルの設計・実装・動作検証を支援するシステムが提案されてきた。このシステムは主に次の二つのコンポーネントから構成されている。第一に、UMLの状態遷移図を用いてプロトコルの動作を定義し、そこからコードを自動生成するコンポーネントである。第二に、生成されたコードを実行するための環境（ハードウェア）を提供するコンポーネントである。これにより、状態遷移図で定義されたプロトコルが実機上で動作し、その動作を検証できる環境が提供されてきた。システムの概要を図\ref{fig:old_system_overview}に示す。
\end{par}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.6\linewidth]{./images/old_system_overview.pdf}
\end{center}
\vspace{-2em} % 画像とキャプションの間に0.5emの垂直スペースを挿入
\caption{先行研究システムの概要図
\label{fig:old_system_overview}
}
\end{figure} 
 
\clearpage


\section{実現事項}
\begin{par}
先行研究システムでは、以下の主要な機能が実現されている。
\begin{itemize}
\item 状態遷移図からのコード自動生成：UMLの状態遷移図を用いてプロトコルの動作を定義し、そこからC言語コードを自動生成する機能が提供されている。これにより、プロトコル設計者は視覚的に動作を定義でき、手動でのコーディング作業を削減できる。
\item 実機上での動作検証：生成されたコードは、無線モデム搭載のマイコンを組み合わせたハードウェア上で実行される。これにより、シミュレーション環境では捉えきれない実機特有の挙動を検証できる。
\end{itemize}
\end{par}

\section{課題}
\begin{par}
先行研究システムには以下の課題が存在する。
\begin{itemize}
\item 状態遷移図の記法の制約：先行研究における状態遷移図からのコード自動生成は、特定の記法に依存しており、複雑なプロトコル動作を表現する際に制約がある。これにより、設計者が意図する動作を完全に反映できない場合がある。
\item デバッグ効率の低さ：デバッグ方法がコンソールへのログ  出力に依存しており、通信処理が高速に進むため逐次的な状態遷移を追跡することが難しい。これにより、複雑な動作を含むプロトコルに対しては、異常動作の原因を把握しづらい。
\end{itemize}
\end{par}

\begin{par}
これらの課題を解決するために、本研究ではデバッグ効率の向上に焦点を当て、実機でのプロトコル検証をより効果的に行える環境を提案する。なお、状態遷移図からのコード生成部については、\cite{kobayashi-yu}で改善が図られているため、そちらを参照されたい。
\end{par}


%_/_/_/_/_/_第３章_/_/_/_/_/_
\chapter{提案システムの概要と設計方針}
本研究では，先行研究システムにおいて課題となっていたデバッグ効率の低さを改善することを目的として，新たなデバッグ支援システムを提案する。本章では，提案システムの概要と設計方針について述べる。はじめに，本研究で対象とする課題を整理し，次に設計方針およびシステム全体の構成について説明する。

\section{設計方針}
\begin{par}
先行研究システムでは，状態遷移図を用いて通信プロトコルを設計し，実機上で動作検証を行うことが可能であった。一方で，デバッグ方法は主に図\ref{fig:old_debug}のように、コンソールへのログ出力に依存しており，状態遷移の流れや内部動作を逐次的に把握することが難しいという課題があった。
\end{par}

% 先行研究システムのデバッグ方法の図
\begin{figure}[h]
\begin{center}
\includegraphics[width=0.6\linewidth]{./images/old_debug.png}
\end{center}
\vspace{-2em} 
\caption{従来のデバッグ方法
\label{fig:old_debug}
}
\end{figure} 

\begin{par}
本研究では，この課題を踏まえ，実機上で実行される通信プロトコルの内部動作をより直感的に把握できるデバッグ支援環境の構築を設計方針とした。具体的には，プロトコルの動作を状態遷移として捉え，その実行状況をログとして取得・可視化することで，動作の流れを段階的に確認できる仕組みを目指す。
\end{par}

\begin{par}
また，本研究のシステムは，先行研究で構築されたプロトコル設計および実機検証の枠組みを活用することを前提とし，既存システムとの親和性を保ちながら改善を行うことを重視した。これにより，研究室内での継続的な利用や拡張が容易な構成とすることを設計上の方針とした。
\end{par}

\section{システムの構成}
\begin{par}
システム全体の構成を図\ref{fig:new_system_overview}に示す。
\end{par}
\begin{par}
提案システムは，先行研究システムに対してデバッグ支援機能を付加する形で構成されている。全体としては，通信プロトコルを実行する組込みシステムと，その動作を外部から確認するためのデバッグ支援システムからなる。
\end{par}

\begin{par}
組込みシステム側では，状態遷移に基づいて通信プロトコルが実行され，その実行過程に関する情報がログとして出力される。一方，デバッグ支援システム側では，出力されたログを収集し，状態遷移の流れや実行状況を可視化する役割を担う。
\end{par}


% 提案システムの概要図
\begin{figure}[h]
\begin{center}
\includegraphics[width=0.6\linewidth]{./images/new_system_overview.pdf}
\end{center}
\vspace{-2em} 
\caption{提案システムの概要図
\label{fig:new_system_overview}
}
\end{figure} 

\section{各コンポーネントの概要}
\begin{par}
提案システムは，主に以下のコンポーネントから構成されている。
\end{par}
\begin{itemize}
    \item 状態遷移図からコードを自動生成するコンポーネント
    \item 通信プロトコルを実行する組込みシステム
    \item デバッグ支援システム
\end{itemize}
\subsection{コード生成コンポーネント}
\begin{par}
はじめに，状態遷移図からコードを自動生成するコンポーネントである。このコンポーネントは，UMLの状態遷移図を解析し，通信プロトコルの動作を表現するC++コードを生成する役割を担う。これにより，設計者は視覚的にプロトコルの動作を定義でき，手動でのコーディング作業を削減できる。
- 状態遷移図の構造を解析し、存在する状態や遷移、イベント、アクションを抽出する。
- 抽出した情報に基づき、C++コードを生成する。
- 生成されたコードは、switch-case文を用いて状態遷移を実装している。
- 生成されたコードは、組込みシステム上で実行される。
\end{par}

\subsection{組込みシステムコンポーネント}
\begin{par}
本システムにおける実行環境を図\ref{fig:devices}に示す。本研究では，SAMD21 マイコンと無線通信モジュールを一体化した無線通信デバイス(株式会社サーキットデザイン製どこでモデム)にGPSモジュールを組み合わせて、一つの無線通信デバイスとして使用した。この無線通信モジュールは429MHz帯で動作する汎用的なものであり，技術基準適合証明(技適)を取得しているため，実際に電波を飛ばしながら通信プロトコルの検証を行うことができる。また，429MHz帯は中山間地域において回折性能に優れており，低消費電力で長距離通信が可能なLPWA（Low Power Wide Area）通信に適している。この特性を活かすことで，登山者見守りシステムなどへの応用も期待できる。さらに，本デバイスはマイコンと通信モジュールが一体化しているため，外部配線や追加ハードウェアを必要とせず，開発や実験環境の構築を容易に行うことが可能である。加えて，GPSモジュールを併用することで，位置情報の取得および1PPS信号による高精度な時刻同期を実現し，複数ノード間での時刻同期による無線通信プロトコルの実現を可能としている。
\end{par}

\begin{figure}[tb]
  \centering
  \includegraphics[width=60mm]{./images/devices.jpg}
  \caption{どこでモデム(左)とGPSモジュール(右)}
  \label{fig:devices}
\end{figure}


\subsection{デバッグ支援システムコンポーネント}
\begin{par}
最後に，本研究の中核であるデバッグ支援システムである。このコンポーネントは，組込みシステムから出力されるログを収集し，状態遷移や内部動作を可視化する役割を担う。これにより，従来は把握が困難であったプロトコルの動作過程を確認できる。このコンポーネントは、次章で詳述する。
\end{par}



%_/_/_/_/_/_第４章_/_/_/_/_/_
\chapter{設計及び実装}
本章では、提案システムの設計および実装について述べる。特に、デバッグ支援システムの設計方針、ログ取得方式、および状態遷移可視化の手法について詳述する。
\section{使用ソフトウェア、ツール}
\begin{par}
使用ソフトウェア、ツールについて説明する。
- astah Professional: UML設計ツール、状態遷移図の作成に使用
- Visual Studio Code: コード編集、開発環境として使用
- PlatformIO: 組込みシステムの開発環境、コードのビルドに使用\cite{platformio}
- Node Package Manager (npm): デバッグ支援システムの開発に使用、フロントエンド

\end{par}
\section{各コンポーネントの接続}
\begin{par}
各コンポーネントの接続について説明する。
- 状態遷移図->コード生成コンポーネント: Pythonスクリプトを実行し、作成したastahの状態遷移図ファイルを選択、C++コードを生成、この時状態遷移図のJSONファイルも生成
- コード生成コンポーネント->組込みシステム：生成されたC++コードをPlatformIOでビルドし、無線通信デバイスに書き込み
- 組込みシステム->デバッグ支援システム: 無線通信デバイスからシリアル通信でログを送信（シリアルモニタで確認可能）
- コード生成コンポーネント->デバッグ支援システム: 状態遷移図のJSONファイルをデバッグ支援システムにアップロードし、状態遷移の可視化に使用
\end{par}

\section{デバッグシステムの設計}
\begin{par}
- ブラウザベースのフロントエンドアプリケーションとして実装
- React.jsを使用してUI、ロジックを構築
- ユーザが状態遷移図のJSONファイルをアップロードし、組込みシステムからのログをリアルタイムで受信
- Mermaid.jsを使用して状態遷移図を描画\cite{Mermaid}\cite{MermaidStateDiagram}
- ログから状態遷移イベントを解析し、状態遷移図上で現在の状態をハイライト表示
- ステップ実行機能を実装し、ユーザが一つずつ状態遷移を確認可能
- 複数の変数を同時に監視できるウォッチ機能を実装
- スライダーを用いて任意の地点のステップにジャンプ可能
\end{par}
\section{ログ取得方式の設計}
\begin{par}
ログ取得方式の設計を書く。
\end{par}
\section{状態遷移可視化の設計}
\begin{par}
状態遷移可視化の設計を書く。
\end{par}
\section{実装概要}
\begin{par}
実装概要を書く。
\end{par}


%_/_/_/_/_/_第５章_/_/_/_/_/_
\chapter{操作例}
\section{操作例の概要}
\begin{par}
本章の目的
想定する利用シナリオ。
\end{par}
\section{操作例}
\begin{par}
操作の流れ（簡潔に）
操作により得られるログ・可視化結果。
\end{par}
\section{デバッグ支援としての有効性}
\begin{par}
操作例から確認できる利点
先行研究との違い。
\end{par}

%_/_/_/_/_/_第６章_/_/_/_/_/_
\chapter{評価と考察}
\section{評価方針}
評価の目的
評価観点の整理
\section{評価方法}
評価環境の説明
評価手順の説明
\section{評価結果と考察}
得られた結果
従来手法との比較
有効性に関する考察

%_/_/_/_/_/_第７章_/_/_/_/_/_
\chapter{まとめと今後の展望}
\section{まとめ}
本研究の成果と意義を総括する。

\section{今後の展望}
今後の課題と研究の方向性について述べる。


% ========
% 参考文献
% ========
\bunken
\begin{thebibliography}{99}
\bibitem{iotanalytics2024} IoT Analytics: "State of IoT 2024: Number of Connected IoT Devices Grows 16\% to 16.6 Billion", 2024.  

\bibitem{grandview2024} Grand View Research: "Industrial Wireless Sensor Network Market Size, Share \& Trends Analysis Report, 2024–2030", 2024.

\bibitem{asahi}旭 健汰, アサノ デービッド, 不破 泰：  
“無線モデムを用いたセンサネットワークMACプロトコル検証システムの開発”，  
信学技報,  NS2023‑147, pp.120–125, Dec. 2023.


\bibitem{kobayashi}小林 遼, アサノ デービッド, 不破 泰：  
“センサーネットワーク検証システムにおける遷移図を用いたMACプロトコル設計環境の開発”，  
信学技報,  NS2023‑148, pp.126–131, Dec. 2023.  

\bibitem{kobayashi-yu}小林 侑生, アサノ デービッド, 不破 泰：

\bibitem{platformio}PlatformIO Labs, “What is PlatformIO?”, 
https://docs.platformio.org/en/latest/
what-is-platformio.html, 参照 Oct. 15, 2025.

\bibitem{Mermaid}Mermaid.js, “Overview,” 
https://mermaid.js.org/intro/, 参照 Oct. 15, 2025.

\bibitem{MermaidStateDiagram}Mermaid.js, “State Diagram Syntax (stateDiagram-v2),” 
https://mermaid.js.org/
syntax/stateDiagram.html, 参照 Oct. 15, 2025.

\bibitem{MQTT}Eclipse Foundation, “MQTT: Message Queuing Telemetry Transport,” 
https://mqtt.org/, 参照 Oct. 15, 2025.

\bibitem{sonoda} 園田 継一郎, 不破 泰, アサノ デービッド, "無線センサーネット
ワークの端末・中継機における送信タイミング決定時間短縮方
法の検討, " 信学技報, NS2022-138, Dec. 2022.


\end{thebibliography}

\end{document}


% \chapter{システム構成と使用技術} 
% 本章では、本研究で開発したデバッグシステムの構成と使用した技術について説明する。
% \section{システム構成}
% \begin{par}
% 本システムは、ハードウェアデバイスとソフトウェアコンポーネントから構成される。ハードウェアデバイスとしては、マイコン、無線モデム、GPSセンサを使用し、これらを 組み合わせてセンサネットワークを構築する。ソフトウェアコンポーネントとしては、使用言語、UML設計ツール、ビルドシステムが含まれ、これらを用いてプロトコルの設計・実装・デバッグを行う。図を挿入してシステム構成を示す。次節以降では、各コンポーネントについて詳細に説明する。
% \end{par}

% \section{ハードウェアデバイス}
% センサネットワークを構築するために使用するハードウェアデバイスについて説明する。
% \subsection{マイコン}
% マイコンについて説明する。
% \subsection{無線モデム}
% 無線モデムについて説明する。
% \subsection{GPSセンサ}
% GPSセンサについて説明する。

% \section{ソフトウェア}
% \subsection{使用言語}
% 使用言語について説明する。
% \subsection{UML設計ツール}
% UML設計ツールについて説明する。
% \subsection{ビルドシステム}
% ビルドシステムについて説明する。

% \section{開発環境}
% \begin{par}
% 開発環境について記述する。
% \end{par}

% \vspace{1cm} % 1cmの垂直スペースを挿入  